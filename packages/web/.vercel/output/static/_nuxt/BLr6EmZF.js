import{_ as F}from"./n5KeTxn4.js";import{g as I,l as J,z as q,A as G,y as i,c as r,a as s,t as c,m as t,d as v,b as B,w as V,k as g,x as H,p as h,v as S,q as w,n as T,s as O,F as W,r as Y,B as z,o as d}from"./DEKUsMT3.js";import{S as Z}from"./CfzA8m0i.js";import{u as K}from"./CLFJ9VCG.js";const Q={class:"mb-8"},X={class:"text-2xl font-extrabold text-white"},ee={class:"text-white/50 text-sm mt-2"},te={key:0,class:"mb-6 p-4 bg-red-500/[0.08] border border-red-500/15 rounded-2xl text-red-300 text-sm text-center animate-fade-in"},se={key:1,class:"mb-6 p-4 bg-indigo-500/[0.08] border border-indigo-500/15 rounded-2xl animate-fade-in"},oe={class:"flex items-center gap-3"},ae={class:"text-indigo-300 text-sm font-medium"},le={class:"text-white/40 text-xs"},ne={key:2,class:"p-5 bg-emerald-500/[0.08] border border-emerald-500/15 rounded-2xl text-emerald-300 text-sm text-center animate-fade-in"},ie={class:"grid grid-cols-1 gap-4"},re={key:0},de=["disabled"],ue=["disabled"],me=["disabled"],ce={class:"relative"},pe=["type","disabled"],ve={class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ge=["d"],fe={key:0,class:"mt-2.5"},be={class:"flex gap-1"},xe={class:"text-xs mt-1.5 text-white/40"},he=["disabled"],we={key:0,class:"flex items-start gap-2.5 p-3.5 bg-red-500/[0.08] border border-red-500/15 rounded-xl text-red-300 text-sm animate-fade-in"},ye=["disabled"],ke={key:0,class:"animate-spin w-4 h-4",fill:"none",viewBox:"0 0 24 24"},_e={class:"text-center text-white/40 text-sm mt-8"},Ae=I({__name:"signup",async setup(Me){let y,P;const U=K(),R=J(),j=q(),k=z(()=>String(j.query.invite??"")),o=i(null),_=i(null);if(k.value)try{const l=([y,P]=G(()=>$fetch(`/api/auth/invite?token=${k.value}`)),y=await y,P(),y);o.value=l.data}catch(l){_.value=l?.data?.message??"Invalid invitation link"}const f=i(""),b=i(o.value?.orgName??""),x=i(o.value?.email??""),n=i(""),M=i(""),N=i(!1),u=i(!1),p=i(null),C=i(null),A=z(()=>{if(!n.value)return 0;let l=0;return n.value.length>=8&&l++,/[A-Z]/.test(n.value)&&l++,/[0-9]/.test(n.value)&&l++,/[^A-Za-z0-9]/.test(n.value)&&l++,l}),D=z(()=>["","Weak","Fair","Good","Strong"][A.value]),L=z(()=>["","bg-red-500","bg-amber-500","bg-indigo-500","bg-green-500"][A.value]??"");async function $(){if(p.value=null,C.value=null,n.value!==M.value){p.value="Passwords do not match.";return}const l={fullName:f.value,organizationName:o.value?o.value.orgName:b.value,email:o.value?o.value.email:x.value,password:n.value},e=Z.safeParse(l);if(!e.success){p.value=e.error.errors[0]?.message??"Validation error";return}u.value=!0;try{const{data:m,error:a}=await U.auth.signUp({email:e.data.email,password:e.data.password,options:{data:{full_name:e.data.fullName,organization_name:e.data.organizationName}}});if(a){a.message.includes("already registered")?p.value="This email is already registered. Try logging in instead.":p.value=a.message;return}if(!m.user){C.value="✉️ Check your email to confirm your account before logging in.";return}if(o.value&&k.value){if(!(await $fetch("/api/auth/accept-invite",{method:"POST",body:{userId:m.user.id,email:e.data.email,fullName:e.data.fullName,token:k.value}})).success)throw new Error("Failed to accept invitation.")}else if(!(await $fetch("/api/auth/setup",{method:"POST",body:{userId:m.user.id,email:e.data.email,fullName:e.data.fullName,organizationName:e.data.organizationName}})).success)throw new Error("Failed to set up your account.");await R.push("/dashboard")}catch(m){p.value=m?.data?.message??m?.message??"An unexpected error occurred."}finally{u.value=!1}}return(l,e)=>{const m=F;return d(),r("div",null,[s("div",Q,[s("h2",X,c(t(o)?"Join your team":"Create your workspace"),1),s("p",ee,c(t(o)?`You've been invited to join ${t(o).orgName}`:"Set up your agency's AI-powered support hub"),1)]),t(_)?(d(),r("div",te,[v(c(t(_))+" ",1),B(m,{to:"/signup",class:"block mt-3 text-white font-semibold underline"},{default:V(()=>[...e[6]||(e[6]=[v(" Sign up without invitation ",-1)])]),_:1})])):g("",!0),t(o)&&!t(_)?(d(),r("div",se,[s("div",oe,[e[7]||(e[7]=s("div",{class:"w-10 h-10 rounded-xl bg-indigo-500/20 flex items-center justify-center flex-shrink-0"},[s("svg",{class:"w-5 h-5 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})])],-1)),s("div",null,[s("p",ae,"Joining "+c(t(o).orgName),1),s("p",le,"Invited by "+c(t(o).invitedBy)+" as "+c(t(o).role),1)])])])):g("",!0),t(C)?(d(),r("div",ne,[v(c(t(C))+" ",1),B(m,{to:"/login",class:"block mt-4 text-white font-semibold underline"},{default:V(()=>[...e[8]||(e[8]=[v(" Back to Login ",-1)])]),_:1})])):(d(),r("form",{key:3,class:"space-y-5",onSubmit:H($,["prevent"])},[s("div",ie,[t(o)?g("",!0):(d(),r("div",re,[e[9]||(e[9]=s("label",{class:"block text-sm text-white/60 mb-2 font-medium"},"Agency / Company name",-1)),h(s("input",{"onUpdate:modelValue":e[0]||(e[0]=a=>w(b)?b.value=a:null),type:"text",placeholder:"Stellar Marketing Agency",class:"input-glass",disabled:t(u)},null,8,de),[[S,t(b)]])])),s("div",null,[e[10]||(e[10]=s("label",{class:"block text-sm text-white/60 mb-2 font-medium"},"Your full name",-1)),h(s("input",{"onUpdate:modelValue":e[1]||(e[1]=a=>w(f)?f.value=a:null),type:"text",placeholder:"María García",class:"input-glass",disabled:t(u)},null,8,ue),[[S,t(f)]])])]),s("div",null,[e[11]||(e[11]=s("label",{class:"block text-sm text-white/60 mb-2 font-medium"},"Work email",-1)),h(s("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>w(x)?x.value=a:null),type:"email",autocomplete:"email",placeholder:"you@company.com",class:T(["input-glass",{"opacity-60":t(o)}]),disabled:t(u)||!!t(o)},null,10,me),[[S,t(x)]])]),s("div",null,[e[12]||(e[12]=s("label",{class:"block text-sm text-white/60 mb-2 font-medium"},"Password",-1)),s("div",ce,[h(s("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>w(n)?n.value=a:null),type:t(N)?"text":"password",autocomplete:"new-password",placeholder:"Min. 8 characters",class:"input-glass pr-10",disabled:t(u)},null,8,pe),[[O,t(n)]]),s("button",{type:"button",class:"absolute right-3 top-1/2 -translate-y-1/2 text-white/30 hover:text-white/60 transition-colors",onClick:e[4]||(e[4]=a=>N.value=!t(N))},[(d(),r("svg",ve,[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:t(N)?"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 4.411m0 0L21 21":"M15 12a3 3 0 11-6 0 3 3 0 016 0zM2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"},null,8,ge)]))])]),t(n)?(d(),r("div",fe,[s("div",be,[(d(),r(W,null,Y(4,a=>s("div",{key:a,class:T(["h-1 flex-1 rounded-full transition-all duration-300",a<=t(A)?t(L):"bg-white/[0.06]"])},null,2)),64))]),s("p",xe,c(t(D)),1)])):g("",!0)]),s("div",null,[e[13]||(e[13]=s("label",{class:"block text-sm text-white/60 mb-2 font-medium"},"Confirm password",-1)),h(s("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>w(M)?M.value=a:null),type:"password",autocomplete:"new-password",placeholder:"••••••••",class:"input-glass",disabled:t(u)},null,8,he),[[S,t(M)]])]),t(p)?(d(),r("div",we,[e[14]||(e[14]=s("svg",{class:"w-4 h-4 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),v(" "+c(t(p)),1)])):g("",!0),e[16]||(e[16]=s("p",{class:"text-white/30 text-xs leading-relaxed"}," By creating an account you agree to our Terms of Service and Privacy Policy. ",-1)),s("button",{type:"submit",disabled:t(u)||!t(x)||!t(n)||!t(f)||!t(o)&&!t(b),class:"w-full py-3.5 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 rounded-xl text-white font-semibold transition-all duration-300 shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40 disabled:opacity-40 disabled:cursor-not-allowed disabled:hover:shadow-indigo-500/25 flex items-center justify-center gap-2"},[t(u)?(d(),r("svg",ke,[...e[15]||(e[15]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"},null,-1)])])):g("",!0),v(" "+c(t(u)?"Setting up workspace...":t(o)?"Join team":"Create free workspace"),1)],8,ye)],32)),s("p",_e,[e[18]||(e[18]=v(" Already have an account? ",-1)),B(m,{to:"/login",class:"text-indigo-400 hover:text-indigo-300 font-semibold transition-colors ml-1"},{default:V(()=>[...e[17]||(e[17]=[v(" Sign in ",-1)])]),_:1})])])}}});export{Ae as default};
