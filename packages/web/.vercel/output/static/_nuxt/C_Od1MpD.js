import{_ as st}from"./CG-kJPW7.js";import{g as nt,A as ot,C as it,c as i,a as t,m as s,F as N,b as f,w as v,k as m,y as c,o as a,d as g,t as l,p as y,H as at,q as lt,v as w,n as A,r as L,I as rt,B as I}from"./BQ0Yrhh0.js";import{u as dt}from"./B_U5j8G_.js";import{u as ut}from"./doLWckKU.js";const ct={class:"animate-fade-in space-y-6 max-w-3xl"},pt={key:0,class:"flex items-center justify-center py-24"},mt={key:1,class:"glass-card p-8 text-center"},gt={class:"space-y-4"},xt={key:0,class:"flex items-center gap-3"},bt={class:"text-white font-medium text-lg"},ht={key:1,class:"flex items-center gap-2"},ft=["disabled"],vt=["disabled"],yt={class:"grid grid-cols-3 gap-4 pt-2 border-t border-white/[0.06]"},wt={class:"text-white font-semibold"},kt={class:"text-white font-semibold"},Ct={class:"text-white/50 text-sm"},_t={class:"flex items-center justify-between mb-4"},Mt={key:0,class:"space-y-3"},At={class:"flex items-center gap-2"},Rt={class:"text-white/70 text-sm"},Et={class:"text-white/50 text-sm font-mono"},Ht={key:1,class:"space-y-3"},Tt={class:"flex items-center gap-2"},zt={class:"text-white/70 text-sm"},Nt={class:"flex items-center gap-2"},St=["onUpdate:modelValue","disabled"],$t={class:"flex items-center justify-end gap-2 pt-2"},Ut=["disabled"],jt={class:"flex items-center justify-between mb-4"},Vt=["disabled"],Lt={class:"flex items-center justify-between mb-4"},Bt={class:"text-white font-semibold text-sm flex items-center gap-2"},Dt={class:"text-white/30 text-xs font-normal"},Ft={key:0,class:"mb-4 p-4 rounded-xl bg-white/[0.03] border border-white/[0.06] space-y-3"},It=["disabled"],Ot=["disabled"],Pt={class:"grid grid-cols-2 gap-3"},Gt=["disabled"],Wt=["disabled"],Kt={class:"flex items-center justify-end gap-2"},qt=["disabled"],Jt={key:0,class:"py-6 text-center"},Xt={key:1,class:"py-6 text-center text-white/30 text-sm"},Zt={key:2,class:"space-y-2"},Qt={class:"flex-1 min-w-0"},Yt={class:"flex items-center gap-2"},te={class:"text-white/80 text-sm font-medium"},ee={key:0,class:"text-indigo-400/60 text-[10px] font-mono bg-indigo-500/10 px-1.5 py-0.5 rounded"},se={key:1,class:"text-white/30 text-[10px]"},ne={class:"text-white/40 text-xs mt-1 line-clamp-2"},oe={class:"text-white/20 text-[10px] mt-1 block"},ie=["onClick"],ce=nt({__name:"settings",async setup(ae){let R,B;const u=dt(),{data:O,pending:P,error:G,refresh:E}=([R,B]=ot(()=>ut("/api/settings",{key:"settings-data"},"$NcOXUh9bJI")),R=await R,B(),R),r=I(()=>O.value?.data),b=I(()=>r.value?.currentUserRole==="ADMIN"),H=c(!1),h=c(""),k=c(!1);function W(){h.value=r.value?.organization.name??"",H.value=!0}async function D(){if(h.value.trim()){k.value=!0;try{await $fetch("/api/settings",{method:"PATCH",body:{name:h.value}}),u.success("Organization name updated"),H.value=!1,await E()}catch(o){u.error(o?.data?.message??"Failed to update name")}finally{k.value=!1}}}const C=c(!1),S=c([]),_=c(!1),$=[{priority:"URGENT",maxResponseMinutes:60,label:"Urgent"},{priority:"HIGH",maxResponseMinutes:240,label:"High"},{priority:"MEDIUM",maxResponseMinutes:480,label:"Medium"},{priority:"LOW",maxResponseMinutes:1440,label:"Low"}];function K(){S.value=$.map(o=>{const e=r.value?.slaConfigs.find(p=>p.priority===o.priority);return{priority:o.priority,maxResponseMinutes:e?.maxResponseMinutes??o.maxResponseMinutes}}),C.value=!0}async function q(){_.value=!0;try{await $fetch("/api/settings",{method:"PATCH",body:{slaConfigs:S.value}}),u.success("SLA policies updated"),C.value=!1,await E()}catch(o){u.error(o?.data?.message??"Failed to update SLA")}finally{_.value=!1}}function J(o){if(o<60)return`${o}m`;const e=Math.floor(o/60),p=o%60;return p>0?`${e}h ${p}m`:`${e}h`}function X(o){return new Date(o).toLocaleDateString("en",{month:"long",day:"numeric",year:"numeric"})}const F={FREE:"bg-white/10 text-white/60 border-white/10",STARTER:"bg-blue-500/20 text-blue-300 border-blue-500/30",PRO:"bg-indigo-500/20 text-indigo-300 border-indigo-500/30",ENTERPRISE:"bg-purple-500/20 text-purple-300 border-purple-500/30"},U=c(!1);async function Z(){if(!(!b.value||!r.value)){U.value=!0;try{await $fetch("/api/settings",{method:"PATCH",body:{autoAssign:!r.value.organization.autoAssign}}),u.success(r.value.organization.autoAssign?"Auto-assign disabled":"Auto-assign enabled"),await E()}catch(o){u.error(o?.data?.message??"Failed to toggle auto-assign")}finally{U.value=!1}}}async function Q(){try{const o=await $fetch("/api/tickets/auto-assign",{method:"POST"});u.success(`Auto-assigned ${o.data.assignedCount} ticket(s)`)}catch(o){u.error(o?.data?.message??"Auto-assign failed")}}const T=c([]),j=c(!1),M=c(!1),d=c({title:"",body:"",category:"",shortcut:""}),x=c(!1);async function V(){j.value=!0;try{const o=await $fetch("/api/canned-responses");T.value=o.data}catch{}finally{j.value=!1}}async function Y(){if(!(!d.value.title.trim()||!d.value.body.trim())){x.value=!0;try{await $fetch("/api/canned-responses",{method:"POST",body:{title:d.value.title,body:d.value.body,category:d.value.category||void 0,shortcut:d.value.shortcut||void 0}}),u.success("Canned response created"),d.value={title:"",body:"",category:"",shortcut:""},M.value=!1,await V()}catch(o){u.error(o?.data?.message??"Failed to create canned response")}finally{x.value=!1}}}async function tt(o){try{await $fetch(`/api/canned-responses/${o}`,{method:"DELETE"}),u.success("Canned response deleted"),await V()}catch(e){u.error(e?.data?.message??"Failed to delete")}}return it(()=>V()),(o,e)=>{const p=st;return a(),i("div",ct,[e[32]||(e[32]=t("div",null,[t("h2",{class:"text-xl font-bold text-white"},"Settings"),t("p",{class:"text-white/40 text-sm mt-1"},"Manage your organization configuration")],-1)),s(P)?(a(),i("div",pt,[...e[10]||(e[10]=[t("div",{class:"animate-spin w-8 h-8 border-2 border-indigo-500 border-t-transparent rounded-full"},null,-1)])])):s(G)?(a(),i("div",mt,[e[11]||(e[11]=t("p",{class:"text-red-300"},"Failed to load settings.",-1)),t("button",{onClick:e[0]||(e[0]=n=>s(E)()),class:"btn-primary mt-4 text-sm"},"Retry")])):s(r)?(a(),i(N,{key:2},[f(p,{padding:"md"},{default:v(()=>[e[18]||(e[18]=t("h3",{class:"text-white font-semibold text-sm mb-4 flex items-center gap-2"},[t("svg",{class:"w-4 h-4 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})]),g(" Organization ")],-1)),t("div",gt,[t("div",null,[e[13]||(e[13]=t("label",{class:"block text-xs text-white/50 uppercase tracking-wider mb-1.5"},"Name",-1)),s(H)?(a(),i("div",ht,[y(t("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>lt(h)?h.value=n:null),type:"text",class:"input-glass flex-1",maxlength:"100",disabled:s(k),onKeyup:at(D,["enter"])},null,40,ft),[[w,s(h)]]),t("button",{onClick:D,disabled:s(k)||!s(h).trim(),class:"btn-primary text-sm"},l(s(k)?"Saving...":"Save"),9,vt),t("button",{onClick:e[2]||(e[2]=n=>H.value=!1),class:"btn-ghost text-sm"},"Cancel")])):(a(),i("div",xt,[t("span",bt,l(s(r).organization.name),1),s(b)?(a(),i("button",{key:0,onClick:W,class:"p-1.5 rounded-lg bg-white/[0.04] hover:bg-white/[0.08] transition-colors",title:"Edit name"},[...e[12]||(e[12]=[t("svg",{class:"w-3.5 h-3.5 text-white/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"})],-1)])])):m("",!0)]))]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-xs text-white/50 uppercase tracking-wider mb-1.5"},"Plan",-1)),t("span",{class:A(["inline-block px-3 py-1 rounded-full text-xs font-semibold border",F[s(r).organization.plan]??F.FREE])},l(s(r).organization.plan),3)]),t("div",yt,[t("div",null,[t("p",wt,l(s(r).memberCount),1),e[15]||(e[15]=t("p",{class:"text-white/30 text-xs"},"Team Members",-1))]),t("div",null,[t("p",kt,l(s(r).ticketCount),1),e[16]||(e[16]=t("p",{class:"text-white/30 text-xs"},"Total Tickets",-1))]),t("div",null,[t("p",Ct,l(X(s(r).organization.createdAt)),1),e[17]||(e[17]=t("p",{class:"text-white/30 text-xs"},"Created",-1))])])])]),_:1}),f(p,{padding:"md"},{default:v(()=>[t("div",_t,[e[19]||(e[19]=t("h3",{class:"text-white font-semibold text-sm flex items-center gap-2"},[t("svg",{class:"w-4 h-4 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})]),g(" SLA Policies ")],-1)),s(b)&&!s(C)?(a(),i("button",{key:0,onClick:K,class:"btn-ghost text-xs"}," Edit ")):m("",!0)]),e[21]||(e[21]=t("p",{class:"text-white/30 text-xs mb-4"},"Maximum response time allowed per priority level.",-1)),s(C)?(a(),i("div",Ht,[(a(!0),i(N,null,L(s(S),(n,z)=>(a(),i("div",{key:n.priority,class:"flex items-center justify-between py-2 px-3 rounded-xl bg-white/[0.03]"},[t("div",Tt,[t("span",{class:A(["w-2 h-2 rounded-full",{"bg-red-400":n.priority==="URGENT","bg-orange-400":n.priority==="HIGH","bg-amber-400":n.priority==="MEDIUM","bg-emerald-400":n.priority==="LOW"}])},null,2),t("span",zt,l($[z]?.label),1)]),t("div",Nt,[y(t("input",{"onUpdate:modelValue":et=>n.maxResponseMinutes=et,type:"number",min:"1",max:"10080",class:"input-glass w-24 text-right text-sm",disabled:s(_)},null,8,St),[[w,n.maxResponseMinutes,void 0,{number:!0}]]),e[20]||(e[20]=t("span",{class:"text-white/30 text-xs w-8"},"min",-1))])]))),128)),t("div",$t,[t("button",{onClick:e[3]||(e[3]=n=>C.value=!1),class:"btn-ghost text-sm"},"Cancel"),t("button",{onClick:q,disabled:s(_),class:"btn-primary text-sm"},l(s(_)?"Saving...":"Save SLA"),9,Ut)])])):(a(),i("div",Mt,[(a(),i(N,null,L($,n=>t("div",{key:n.priority,class:"flex items-center justify-between py-2 px-3 rounded-xl bg-white/[0.03]"},[t("div",At,[t("span",{class:A(["w-2 h-2 rounded-full",{"bg-red-400":n.priority==="URGENT","bg-orange-400":n.priority==="HIGH","bg-amber-400":n.priority==="MEDIUM","bg-emerald-400":n.priority==="LOW"}])},null,2),t("span",Rt,l(n.label),1)]),t("span",Et,l(J(s(r).slaConfigs.find(z=>z.priority===n.priority)?.maxResponseMinutes??n.maxResponseMinutes)),1)])),64))]))]),_:1}),f(p,{padding:"md"},{default:v(()=>[t("div",jt,[e[22]||(e[22]=t("h3",{class:"text-white font-semibold text-sm flex items-center gap-2"},[t("svg",{class:"w-4 h-4 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"})]),g(" Auto-Assignment ")],-1)),s(b)?(a(),i("button",{key:0,class:A(["relative w-11 h-6 rounded-full transition-colors duration-200 focus:outline-none",s(r).organization.autoAssign?"bg-indigo-500":"bg-white/10"]),disabled:s(U),onClick:Z},[t("span",{class:A(["absolute top-0.5 left-0.5 w-5 h-5 rounded-full bg-white transition-transform duration-200",s(r).organization.autoAssign?"translate-x-5":"translate-x-0"])},null,2)],10,Vt)):m("",!0)]),e[24]||(e[24]=t("p",{class:"text-white/30 text-xs mb-3"}," When enabled, new tickets are automatically distributed to available agents using round-robin. ",-1)),s(b)&&s(r).organization.autoAssign?(a(),i("button",{key:0,class:"btn-ghost text-xs flex items-center gap-1.5",onClick:Q},[...e[23]||(e[23]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),g(" Assign unassigned tickets now ",-1)])])):m("",!0)]),_:1}),f(p,{padding:"md"},{default:v(()=>[t("div",Lt,[t("h3",Bt,[e[25]||(e[25]=t("svg",{class:"w-4 h-4 text-indigo-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})],-1)),e[26]||(e[26]=g(" Canned Responses ",-1)),t("span",Dt,"("+l(s(T).length)+")",1)]),s(b)?(a(),i("button",{key:0,class:"btn-primary text-xs flex items-center gap-1.5",onClick:e[4]||(e[4]=n=>M.value=!s(M))},[...e[27]||(e[27]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),g(" New Template ",-1)])])):m("",!0)]),e[30]||(e[30]=t("p",{class:"text-white/30 text-xs mb-4"},[g(" Pre-written reply templates agents can insert with one click. Use "),t("code",{class:"text-indigo-400/60"},"{{ticket.customerName}}"),g(" for dynamic values. ")],-1)),f(rt,{name:"fade"},{default:v(()=>[s(M)?(a(),i("div",Ft,[y(t("input",{"onUpdate:modelValue":e[5]||(e[5]=n=>s(d).title=n),type:"text",placeholder:"Template title (e.g., Greeting)",class:"input-glass w-full text-sm",disabled:s(x)},null,8,It),[[w,s(d).title]]),y(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=n=>s(d).body=n),rows:"3",placeholder:"Template body... (e.g., Hi {{ticket.customerName}}, thanks for reaching out!)",class:"input-glass w-full text-sm resize-none",disabled:s(x)},null,8,Ot),[[w,s(d).body]]),t("div",Pt,[y(t("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>s(d).category=n),type:"text",placeholder:"Category (optional)",class:"input-glass text-sm",disabled:s(x)},null,8,Gt),[[w,s(d).category]]),y(t("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>s(d).shortcut=n),type:"text",placeholder:"Shortcut (e.g., /greet)",class:"input-glass text-sm",disabled:s(x)},null,8,Wt),[[w,s(d).shortcut]])]),t("div",Kt,[t("button",{onClick:e[9]||(e[9]=n=>M.value=!1),class:"btn-ghost text-sm"},"Cancel"),t("button",{onClick:Y,disabled:s(x)||!s(d).title.trim()||!s(d).body.trim(),class:"btn-primary text-sm"},l(s(x)?"Creating...":"Create"),9,qt)])])):m("",!0)]),_:1}),s(j)?(a(),i("div",Jt,[...e[28]||(e[28]=[t("div",{class:"animate-spin w-5 h-5 border-2 border-indigo-500 border-t-transparent rounded-full mx-auto"},null,-1)])])):s(T).length?(a(),i("div",Zt,[(a(!0),i(N,null,L(s(T),n=>(a(),i("div",{key:n.id,class:"flex items-start justify-between gap-3 p-3 rounded-xl bg-white/[0.03] hover:bg-white/[0.05] transition-colors"},[t("div",Qt,[t("div",Yt,[t("span",te,l(n.title),1),n.shortcut?(a(),i("span",ee,l(n.shortcut),1)):m("",!0),n.category?(a(),i("span",se,l(n.category),1)):m("",!0)]),t("p",ne,l(n.body),1),t("span",oe,"Used "+l(n.usageCount)+" time"+l(n.usageCount===1?"":"s"),1)]),s(b)?(a(),i("button",{key:0,class:"text-white/20 hover:text-red-400 transition-colors flex-shrink-0 p-1",onClick:z=>tt(n.id)},[...e[29]||(e[29]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ie)):m("",!0)]))),128))])):(a(),i("div",Xt," No canned responses yet. Create one to help agents reply faster. "))]),_:1}),f(p,{padding:"md"},{default:v(()=>[...e[31]||(e[31]=[t("h3",{class:"text-red-400 font-semibold text-sm mb-2 flex items-center gap-2"},[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})]),g(" Danger Zone ")],-1),t("p",{class:"text-white/30 text-xs mb-4"},"Irreversible actions. Contact support for account deletion.",-1),t("button",{disabled:"",class:"btn-danger text-sm opacity-50 cursor-not-allowed"}," Delete Organization ",-1)])]),_:1})],64)):m("",!0)])}}});export{ce as default};
