import{_ as Y}from"./n5KeTxn4.js";import{_ as Z}from"./B-WpmOWF.js";import{g as ee,z as te,l as se,y as k,C as oe,N as ne,c as l,a as t,t as a,m as o,b as _,w,I as re,o as r,d as h,p as N,q as O,v as ie,E as U,k as u,D as le,x as $,n as v,F as L,r as j,G as ae,B as D,_ as de}from"./DEKUsMT3.js";import{u as ue,a as ce}from"./DwRTkHxg.js";import{u as pe}from"./BO4G2Npx.js";import{u as xe}from"./CLFJ9VCG.js";import{u as ge}from"./B5DQxwAU.js";import"./CfzA8m0i.js";const me={class:"space-y-5 animate-fade-in"},fe={class:"flex items-center justify-between"},he={class:"text-white/50 text-sm mt-0.5"},ve={class:"flex flex-wrap items-center gap-3"},be={class:"relative flex-1 min-w-[200px]"},we={class:"flex items-center justify-between flex-wrap gap-3"},ye={class:"flex items-center gap-2"},ke={class:"text-white font-medium text-sm"},_e={class:"flex items-center gap-2 flex-wrap"},Ce=["disabled"],Se=["disabled"],Te=["disabled"],Ee=["disabled"],Pe=["disabled"],Me={class:"px-5 py-3 border-b border-white/10"},Ne={class:"grid grid-cols-[auto_1fr_auto_auto_auto_auto] gap-3 items-center text-xs text-white/40 font-medium uppercase tracking-wider"},Oe=["checked"],Ae={key:0,class:"p-4 space-y-2"},Be={key:1,class:"py-12 text-center text-red-400 text-sm"},Ie={key:2,class:"py-16 text-center"},Re={class:"text-white/40 text-sm"},Ue={key:3,class:"divide-y divide-white/5"},$e=["checked","onChange"],Le={class:"flex items-center gap-2"},je={key:0,class:"inline-flex flex-shrink-0 w-1.5 h-1.5 rounded-full bg-red-500 animate-pulse",title:"SLA Breaching"},De={class:"text-white text-sm font-medium truncate group-hover:text-indigo-300 transition-colors"},Ve=["title"],qe=["title"],Ge={class:"text-white/40 text-xs mt-0.5 truncate"},ze={key:0,class:"ml-2"},Fe={class:"hidden md:flex items-center gap-1.5"},He={class:"hidden lg:flex items-center justify-center w-7 h-7"},We=["title"],Ke={key:1,class:"w-7 h-7 rounded-full bg-white/10 flex items-center justify-center text-white/20"},Je={class:"text-white/30 text-xs whitespace-nowrap"},Qe={key:4,class:"flex items-center justify-between px-5 py-3 border-t border-white/10"},Xe={class:"text-white/40 text-xs"},Ye={class:"flex gap-2"},Ze=["disabled"],et=["disabled"],tt=ee({__name:"index",setup(st){const n=ue(),V=pe(),b=te(),C=se(),{subscribe:q}=ce(),G=xe();let S=null;const p=k(String(b.query.search??""));let T=null;const x=k(String(b.query.status??"")),g=k(String(b.query.priority??""));oe(async()=>{await n.fetchTickets({search:p.value||void 0,status:x.value||void 0,priority:g.value||void 0});const i=V.currentUser?.orgId;i&&(S=q(i))}),ne(()=>{S&&(G.removeChannel(S),S=null)});function z(){T&&clearTimeout(T),T=setTimeout(()=>{C.replace({query:{...b.query,search:p.value||void 0,page:void 0}}),n.setFilter("search",p.value||void 0)},400)}function F(){C.replace({query:{...b.query,status:x.value||void 0,page:void 0}}),n.setFilter("status",x.value||void 0)}function H(){C.replace({query:{...b.query,priority:g.value||void 0,page:void 0}}),n.setFilter("priority",g.value||void 0)}function A(){p.value="",x.value="",g.value="",C.replace({query:{}}),n.resetFilters()}function E(i){const e=n.filters.sortBy,c=n.filters.sortOrder;e===i?n.setFilter("sortOrder",c==="desc"?"asc":"desc"):(n.filters.sortBy=i,n.filters.sortOrder="desc",n.fetchTickets())}const B={OPEN:{label:"Open",class:"bg-blue-500/20 text-blue-300 border border-blue-500/30"},IN_PROGRESS:{label:"In Progress",class:"bg-amber-500/20 text-amber-300 border border-amber-500/30"},RESOLVED:{label:"Resolved",class:"bg-green-500/20 text-green-300 border border-green-500/30"},CLOSED:{label:"Closed",class:"bg-white/10 text-white/50 border border-white/10"}},P={URGENT:{label:"Urgent",dot:"bg-red-500",text:"text-red-400"},HIGH:{label:"High",dot:"bg-orange-400",text:"text-orange-400"},MEDIUM:{label:"Medium",dot:"bg-amber-400",text:"text-amber-400"},LOW:{label:"Low",dot:"bg-green-400",text:"text-green-400"}},W={POSITIVE:"üòä",NEUTRAL:"üòê",NEGATIVE:"üò°"},K={EMAIL:"‚úâÔ∏è",WHATSAPP:"üí¨",WEB:"üåê",SLACK:"‚ö°"};function J(i){const e=typeof i=="string"?new Date(i):i,c=Date.now()-e.getTime(),m=Math.floor(c/6e4);if(m<1)return"just now";if(m<60)return`${m}m ago`;const s=Math.floor(m/60);return s<24?`${s}h ago`:`${Math.floor(s/24)}d ago`}const M=D(()=>!!(p.value||x.value||g.value)),d=k(new Set),f=k(!1),I=ge(),R=D(()=>n.tickets.length?n.tickets.every(i=>d.value.has(i.id)):!1);function Q(){R.value?d.value.clear():n.tickets.forEach(i=>d.value.add(i.id))}function X(i){d.value.has(i)?d.value.delete(i):d.value.add(i)}async function y(i,e){if(d.value.size){f.value=!0;try{const c=await $fetch("/api/tickets/bulk",{method:"POST",body:{ticketIds:Array.from(d.value),action:i,value:e}});I.success(`Updated ${c.data.updatedCount} ticket(s)`),d.value.clear(),await n.fetchTickets()}catch(c){I.error(c?.data?.message??"Bulk action failed")}finally{f.value=!1}}}return(i,e)=>{const c=Y,m=Z;return r(),l("div",me,[t("div",fe,[t("div",null,[e[17]||(e[17]=t("h2",{class:"text-2xl font-bold text-white"},"Tickets",-1)),t("p",he,a(o(n).meta?.total??"...")+" total tickets ",1)]),_(c,{to:"/dashboard/tickets/new",class:"btn-primary flex items-center gap-2 text-sm"},{default:w(()=>[...e[18]||(e[18]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),h(" New Ticket ",-1)])]),_:1})]),_(m,{padding:"sm"},{default:w(()=>[t("div",ve,[t("div",be,[e[19]||(e[19]=t("svg",{class:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-white/30",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1)),N(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>O(p)?p.value=s:null),type:"search",placeholder:"Search tickets...",class:"input-glass pl-9 text-sm",onInput:z},null,544),[[ie,o(p)]])]),N(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>O(x)?x.value=s:null),class:"input-glass select-arrow text-sm min-w-[130px] cursor-pointer appearance-none pr-10",onChange:F},[...e[20]||(e[20]=[t("option",{value:""},"All statuses",-1),t("option",{value:"OPEN"},"Open",-1),t("option",{value:"IN_PROGRESS"},"In Progress",-1),t("option",{value:"RESOLVED"},"Resolved",-1),t("option",{value:"CLOSED"},"Closed",-1)])],544),[[U,o(x)]]),N(t("select",{"onUpdate:modelValue":e[2]||(e[2]=s=>O(g)?g.value=s:null),class:"input-glass select-arrow text-sm min-w-[130px] cursor-pointer appearance-none pr-10",onChange:H},[...e[21]||(e[21]=[t("option",{value:""},"All priorities",-1),t("option",{value:"URGENT"},"üî¥ Urgent",-1),t("option",{value:"HIGH"},"üü† High",-1),t("option",{value:"MEDIUM"},"üü° Medium",-1),t("option",{value:"LOW"},"üü¢ Low",-1)])],544),[[U,o(g)]]),o(M)?(r(),l("button",{key:0,class:"btn-ghost text-sm flex items-center gap-1.5",onClick:A},[...e[22]||(e[22]=[t("svg",{class:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1),h(" Clear ",-1)])])):u("",!0)])]),_:1}),_(re,{name:"fade"},{default:w(()=>[o(d).size>0?(r(),le(m,{key:0,padding:"md"},{default:w(()=>[t("div",we,[t("div",ye,[t("span",ke,a(o(d).size)+" selected",1),t("button",{class:"text-white/40 hover:text-white/60 text-xs underline transition-colors",onClick:e[3]||(e[3]=s=>o(d).clear())}," Clear ")]),t("div",_e,[t("button",{class:"btn-ghost text-xs px-3 py-1.5 flex items-center gap-1.5",disabled:o(f),onClick:e[4]||(e[4]=s=>y("updateStatus","IN_PROGRESS"))}," ‚öôÔ∏è Mark In Progress ",8,Ce),t("button",{class:"btn-ghost text-xs px-3 py-1.5 flex items-center gap-1.5",disabled:o(f),onClick:e[5]||(e[5]=s=>y("updateStatus","RESOLVED"))}," ‚úÖ Resolve ",8,Se),t("button",{class:"btn-ghost text-xs px-3 py-1.5 flex items-center gap-1.5",disabled:o(f),onClick:e[6]||(e[6]=s=>y("updateStatus","CLOSED"))}," üîí Close ",8,Te),t("button",{class:"btn-ghost text-xs px-3 py-1.5 flex items-center gap-1.5 text-red-400 hover:text-red-300",disabled:o(f),onClick:e[7]||(e[7]=s=>y("updatePriority","URGENT"))}," üî¥ Urgent ",8,Ee),t("button",{class:"btn-ghost text-xs px-3 py-1.5 flex items-center gap-1.5",disabled:o(f),onClick:e[8]||(e[8]=s=>y("unassign"))}," Unassign ",8,Pe)])])]),_:1})):u("",!0)]),_:1}),_(m,{padding:"none"},{default:w(()=>[t("div",Me,[t("div",Ne,[t("label",{class:"flex items-center cursor-pointer",onClick:e[9]||(e[9]=$(()=>{},["stop"]))},[t("input",{type:"checkbox",checked:o(R),class:"w-3.5 h-3.5 rounded border-white/20 bg-white/5 text-indigo-500 focus:ring-indigo-500/30 cursor-pointer",onChange:Q},null,40,Oe)]),t("button",{class:"text-left flex items-center gap-1 hover:text-white/60 transition-colors",onClick:e[10]||(e[10]=s=>E("createdAt"))},[e[24]||(e[24]=h(" Ticket ",-1)),o(n).filters.sortBy==="createdAt"?(r(),l("svg",{key:0,class:v(["w-3 h-3",o(n).filters.sortOrder==="asc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[23]||(e[23]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2)):u("",!0)]),e[29]||(e[29]=t("span",{class:"hidden md:block"},"Status",-1)),t("button",{class:"hidden md:flex items-center gap-1 hover:text-white/60 transition-colors",onClick:e[11]||(e[11]=s=>E("priority"))},[e[26]||(e[26]=h(" Priority ",-1)),o(n).filters.sortBy==="priority"?(r(),l("svg",{key:0,class:v(["w-3 h-3",o(n).filters.sortOrder==="asc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[25]||(e[25]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2)):u("",!0)]),e[30]||(e[30]=t("span",{class:"hidden lg:block"},"Agent",-1)),t("button",{class:"flex items-center gap-1 hover:text-white/60 transition-colors",onClick:e[12]||(e[12]=s=>E("updatedAt"))},[e[28]||(e[28]=h(" Updated ",-1)),o(n).filters.sortBy==="updatedAt"?(r(),l("svg",{key:0,class:v(["w-3 h-3",o(n).filters.sortOrder==="asc"?"rotate-180":""]),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[...e[27]||(e[27]=[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 9l-7 7-7-7"},null,-1)])],2)):u("",!0)])])]),o(n).isLoadingList?(r(),l("div",Ae,[(r(),l(L,null,j(8,s=>t("div",{key:s,class:"h-14 rounded-lg bg-white/5 animate-pulse",style:ae({animationDelay:`${s*50}ms`})},null,4)),64))])):o(n).error?(r(),l("div",Be,[h(a(o(n).error)+" ",1),t("button",{class:"block mx-auto mt-3 text-white/40 hover:text-white/60 transition-colors underline text-xs",onClick:e[13]||(e[13]=s=>o(n).fetchTickets())}," Try again ")])):o(n).tickets.length?(r(),l("div",Ue,[(r(!0),l(L,null,j(o(n).tickets,s=>(r(),l("div",{key:s.id,class:v(["grid grid-cols-[auto_1fr_auto_auto_auto_auto] gap-3 items-center px-5 py-4 hover:bg-white/5 transition-colors group",{"bg-indigo-500/5":o(d).has(s.id)}])},[t("label",{class:"flex items-center cursor-pointer",onClick:e[14]||(e[14]=$(()=>{},["stop"]))},[t("input",{type:"checkbox",checked:o(d).has(s.id),class:"w-3.5 h-3.5 rounded border-white/20 bg-white/5 text-indigo-500 focus:ring-indigo-500/30 cursor-pointer",onChange:ot=>X(s.id)},null,40,$e)]),_(c,{to:`/dashboard/tickets/${s.id}`,class:"min-w-0"},{default:w(()=>[t("div",Le,[s.isBreachingSla?(r(),l("span",je)):u("",!0),t("p",De,a(s.subject),1),s.sentiment?(r(),l("span",{key:1,class:"flex-shrink-0 text-xs",title:s.sentiment},a(W[s.sentiment]),9,Ve)):u("",!0),s.channel?(r(),l("span",{key:2,class:"flex-shrink-0 text-xs",title:s.channel},a(K[s.channel]),9,qe)):u("",!0)]),t("p",Ge,[h(a(s.customerName||s.customerEmail||"Unknown customer")+" ",1),(s._count?.messages??0)>0?(r(),l("span",ze," ¬∑ "+a(s._count?.messages)+" msg"+a((s._count?.messages??0)===1?"":"s"),1)):u("",!0)])]),_:2},1032,["to"]),t("span",{class:v(["hidden md:inline-flex px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap",B[s.status]?.class])},a(B[s.status]?.label),3),t("div",Fe,[t("div",{class:v(["w-2 h-2 rounded-full",P[s.priority]?.dot])},null,2),t("span",{class:v(["text-xs",P[s.priority]?.text])},a(P[s.priority]?.label),3)]),t("div",He,[s.assignedTo?(r(),l("div",{key:0,class:"w-7 h-7 rounded-full bg-gradient-to-br from-indigo-400 to-purple-500 flex items-center justify-center text-white text-xs font-bold",title:s.assignedTo.fullName},a(s.assignedTo.fullName.charAt(0).toUpperCase()),9,We)):(r(),l("div",Ke,[...e[32]||(e[32]=[t("svg",{class:"w-3 h-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)])]))]),t("span",Je,a(J(s.updatedAt)),1)],2))),128))])):(r(),l("div",Ie,[e[31]||(e[31]=t("div",{class:"w-14 h-14 mx-auto mb-4 rounded-2xl bg-white/5 flex items-center justify-center"},[t("svg",{class:"w-7 h-7 text-white/20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})])],-1)),t("p",Re,a(o(M)?"No tickets match your filters.":"No tickets yet."),1),o(M)?(r(),l("button",{key:0,class:"mt-3 text-indigo-400 hover:text-indigo-300 text-sm transition-colors",onClick:A}," Clear filters ")):u("",!0)])),(o(n).meta?.totalPages??0)>1?(r(),l("div",Qe,[t("p",Xe," Page "+a(o(n).currentPage)+" of "+a(o(n).totalPages)+" ¬∑ "+a(o(n).meta?.total)+" tickets ",1),t("div",Ye,[t("button",{disabled:!o(n).hasPrevPage,class:"btn-ghost text-xs px-3 py-1.5 disabled:opacity-30",onClick:e[15]||(e[15]=s=>o(n).goToPage(o(n).currentPage-1))}," ‚Üê Prev ",8,Ze),t("button",{disabled:!o(n).hasNextPage,class:"btn-ghost text-xs px-3 py-1.5 disabled:opacity-30",onClick:e[16]||(e[16]=s=>o(n).goToPage(o(n).currentPage+1))}," Next ‚Üí ",8,et)])])):u("",!0)]),_:1})])}}}),pt=de(tt,[["__scopeId","data-v-b5a88f46"]]);export{pt as default};
