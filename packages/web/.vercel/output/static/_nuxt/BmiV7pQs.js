import{_ as h}from"./I6UOz-_e.js";import{u as x}from"./DqtgAKHa.js";import{g as b,l as w,z as y,C as k,c as d,m as n,j as p,a as t,t as c,b as _,w as N,y as v,o as l,d as S}from"./BQ0Yrhh0.js";const C={class:"text-center"},j={key:0,class:"animate-fade-in"},B={class:"text-white/50 text-sm"},T={key:1,class:"animate-fade-in"},E={class:"text-white/50 text-sm"},V={key:2,class:"animate-fade-in"},A={class:"text-white/50 text-sm mb-8"},D=b({__name:"confirm",setup(M){const m=x(),u=w(),f=y(),a=v("loading"),s=v("Verifying your account...");async function g(o){try{const{data:e}=await $fetch("/api/users/me",{method:"GET"}).catch(()=>({data:null}));if(!e){const i=o.user_metadata?.full_name||o.user_metadata?.name||o.email?.split("@")[0]||"New User",r=o.user_metadata?.organization_name||`${i}'s Agency`;await $fetch("/api/auth/setup",{method:"POST",body:{userId:o.id,email:o.email,fullName:i,organizationName:r}})}}catch(e){console.warn("[confirm] Could not verify/create Prisma user:",e)}}return k(async()=>{if(f.query.error){a.value="error",s.value=String(f.query.error_description||"Authentication failed. Please try again.");return}const{data:{subscription:o}}=m.auth.onAuthStateChange(async(i,r)=>{i==="SIGNED_IN"&&r?.user&&(s.value="Setting up your workspace...",await g(r.user),a.value="success",s.value="All set! Redirecting to your dashboard...",setTimeout(async()=>{await u.push("/dashboard")},1200)),i==="USER_UPDATED"&&r?.user&&(a.value="success",s.value="Email confirmed! Redirecting to your dashboard...",setTimeout(async()=>{await u.push("/dashboard")},1200))}),{data:{session:e}}=await m.auth.getSession();e?.user&&(await g(e.user),a.value="success",s.value="Welcome back! Redirecting...",setTimeout(async()=>{await u.push("/dashboard")},800)),setTimeout(()=>{a.value==="loading"&&(a.value="error",s.value="Verification timed out. Please try logging in again.",o.unsubscribe())},1e4)}),(o,e)=>{const i=h;return l(),d("div",C,[n(a)==="loading"?(l(),d("div",j,[e[0]||(e[0]=p('<div class="w-20 h-20 mx-auto mb-8 relative"><div class="absolute inset-0 rounded-full border-[3px] border-white/[0.06]"></div><div class="absolute inset-0 rounded-full border-[3px] border-t-indigo-500 border-r-purple-500 animate-spin"></div><div class="absolute inset-3 rounded-full bg-gradient-to-br from-indigo-500/20 to-purple-500/20 flex items-center justify-center backdrop-blur-sm"><svg class="w-6 h-6 text-indigo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg></div></div><h2 class="text-2xl font-extrabold text-white mb-2">Authenticating</h2>',2)),t("p",B,c(n(s)),1)])):n(a)==="success"?(l(),d("div",T,[e[1]||(e[1]=t("div",{class:"w-20 h-20 mx-auto mb-8 rounded-full bg-emerald-500/[0.12] border border-emerald-500/20 flex items-center justify-center"},[t("svg",{class:"w-9 h-9 text-emerald-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})])],-1)),e[2]||(e[2]=t("h2",{class:"text-2xl font-extrabold text-white mb-2"},"You're in!",-1)),t("p",E,c(n(s)),1),e[3]||(e[3]=p('<div class="mt-6 flex justify-center"><div class="flex gap-1.5"><div class="w-1.5 h-1.5 rounded-full bg-indigo-400 animate-pulse" style="animation-delay:0s;"></div><div class="w-1.5 h-1.5 rounded-full bg-indigo-400 animate-pulse" style="animation-delay:0.2s;"></div><div class="w-1.5 h-1.5 rounded-full bg-indigo-400 animate-pulse" style="animation-delay:0.4s;"></div></div></div>',1))])):(l(),d("div",V,[e[5]||(e[5]=t("div",{class:"w-20 h-20 mx-auto mb-8 rounded-full bg-red-500/[0.12] border border-red-500/20 flex items-center justify-center"},[t("svg",{class:"w-9 h-9 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1)),e[6]||(e[6]=t("h2",{class:"text-2xl font-extrabold text-white mb-2"},"Something went wrong",-1)),t("p",A,c(n(s)),1),_(i,{to:"/login",class:"inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-indigo-500 to-purple-600 hover:from-indigo-400 hover:to-purple-500 rounded-xl text-white font-semibold transition-all duration-300 shadow-lg shadow-indigo-500/25 hover:shadow-indigo-500/40"},{default:N(()=>[...e[4]||(e[4]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1),S(" Back to Login ",-1)])]),_:1})]))])}}});export{D as default};
